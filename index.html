<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RavenQuest World Time + Player Link</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= ESTILOS GERAIS ================= */
body {
    margin: 0;
    font-family: 'Orbitron', Arial, sans-serif;
    background: radial-gradient(circle at top, #0b0f1a, #000);
    color: #e6e6e6;
    transition: background 0.6s;
    overflow-x: hidden;
}
body.morning { background: radial-gradient(circle at top, #1e3a8a, #020617); }
body.afternoon { background: radial-gradient(circle at top, #7c2d12, #020617); }
body.night { background: radial-gradient(circle at top, #020617, #000); }
body.dawn { background: radial-gradient(circle at top, #312e81, #020617); }

h1 {
    text-align: center;
    margin-top: 20px;
    color: #9d4edd;
    text-shadow: 0 0 15px #7b2cbf;
}

.container {
    max-width: 1000px;
    margin: auto;
    padding: 20px;
}

/* ================= REL√ìGIO ================= */
.clock {
    background: linear-gradient(145deg, #111827, #020617);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

.clock span {
    font-size: 2.6rem;
    color: #c77dff;
    display: block;
    margin: 10px 0;
}

/* ================= FILTROS ================= */
.filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
    gap: 10px;
    margin-bottom: 20px;
}

.filters input {
    background: #020617;
    color: #e6e6e6;
    border: 1px solid #334155;
    border-radius: 8px;
    padding: 10px;
    outline: none;
}
.filters input:focus {
    border-color: #9d4edd;
}

/* ================= LISTA DE EVENTOS ================= */
.events {
    background: linear-gradient(145deg, #0f172a, #020617);
    border-radius: 12px;
    padding: 20px;
    min-height: 200px;
}

.event {
    position: relative;
    border: 1px solid #334155;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 12px;
    background: rgba(15,23,42,0.85);
    transition: transform 0.2s, border-color 0.2s;
}

.event:hover {
    transform: translateX(5px);
    border-color: #c77dff;
}

.event.active {
    border-color: #22c55e;
    box-shadow: 0 0 15px rgba(34,197,94,0.6);
}

.event.upcoming {
    border-color: #eab308;
}

/* Estilo do T√≠tulo clic√°vel */
.event-title {
    font-size: 1.1rem;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: color 0.2s;
}

.event-title.has-video {
    cursor: pointer;
    text-decoration: underline;
    text-decoration-color: rgba(255,255,255,0.3);
}

.event-title.has-video:hover {
    color: #c77dff;
    text-decoration-color: #c77dff;
}

.video-icon {
    font-size: 0.8rem;
    background: #ef4444;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    opacity: 0.8;
}

.event-info {
    font-size: 0.85rem;
    color: #94a3b8;
    margin-top: 5px;
    line-height: 1.4;
}

/* ================= TOOLTIP DO V√çDEO ================= */
#videoTooltip {
    position: fixed;
    display: none;
    width: 240px;
    height: 135px;
    background: #000;
    border: 2px solid #9d4edd;
    border-radius: 8px;
    z-index: 9000;
    pointer-events: none;
    overflow: hidden;
    box-shadow: 0 0 20px rgba(0,0,0,0.8);
}
#videoTooltip img { width: 100%; height: 100%; object-fit: cover; }
#videoTooltip .no-video { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #666; font-size: 0.8rem; background: #111; }

/* ================= MODAL DE V√çDEO ================= */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10000;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
}

.modal-content {
    position: relative;
    width: 90%;
    max-width: 800px;
    aspect-ratio: 16/9;
    background: #000;
    border: 2px solid #9d4edd;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(157, 78, 221, 0.4);
}

.modal-content iframe {
    width: 100%;
    height: 100%;
    border-radius: 10px;
    border: none;
}

.close-btn {
    position: absolute;
    top: -40px;
    right: 0;
    color: #fff;
    font-size: 30px;
    cursor: pointer;
    font-weight: bold;
    transition: color 0.3s;
}
.close-btn:hover { color: #ef4444; }

</style>
</head>

<body>
<h1>üïí RavenQuest World Time</h1>

<div class="container">
    <div class="clock">
        <div>Hor√°rio In-Game</div>
        <span id="gameClock">00:00:00</span>
        <div id="phase">--</div>
    </div>

    <div class="filters">
        <input type="number" id="filterLevel" placeholder="Level m√≠nimo">
        <input type="text" id="filterMap" placeholder="Mapa">
        <input type="time" id="filterTime">
    </div>

    <div class="events" id="eventList"></div>
</div>

<div id="videoTooltip"></div>

<div id="videoModal" class="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-btn" onclick="closeModal()">‚úï Fechar</span>
        <iframe id="youtubePlayer" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<script>
/* ================= CONFIG ================= */
const BASE_REAL_TIME = { h:19, m:0, s:42 };
const MULTIPLIER = 12;

/* ================= EVENTOS (COM LINK COMPLETO) ================= */
// AGORA VOC√ä PODE COLOCAR O LINK INTEIRO DO YOUTUBE
const events = [
{
    name:"Ritual Embriagado",
    map:"Glademire",
    type:"World-Time Event",
    level:8,
    startTime:"08:00:00",
    videoUrl: "none" 
},
{
    name:"Ritual Embriagado",
    map:"Glademire",
    type:"World-Time Event",
    level:8,
    startTime:"20:00:00",
    videoUrl: "none" 
},
{
    name:"Louvor ao Sol",
    map:"Gilead Island",
    type:"Trigger Event",
    level:45,
    startTime:"05:24:00",
    videoUrl: "none" 
},
{
    name:"Fenda do Caos",
    map:"Deserto de Ashkar",
    type:"World Event",
    level:45,
    startTime:"18:00:00",
    videoUrl: "none"
},
{
    name:"Sacrif√≠cio Noturno",
    map:"Gilead Island",
    type:"Trigger Event",
    level:45,
    startTime:"18:00:00",
    videoUrl: "none"
},
{
    name:"Passagens Ocultas",
    map:"Rohna Woods",
    type:"Trigger Event",
    level:16,
    startTime:"20:00:00",
    videoUrl: "none"
},
{
    name:"Passagens Ocultas",
    map:"Rohna Woods",
    type:"Trigger Event",
    level:16,
    startTime:"05:45:00",
    videoUrl: "none"
},
{
    name:"Uma Escolta √† Defiance",
    map:"Zephyr Vale",
    type:"Trigger Event",
    level:33,
    startTime:"00:00:00",
    videoUrl: "none"
},
{
    name:"Abelhas Assassinas",
    map:"Rohna Woods",
    type:"Mob-Spawn Event",
    level:15,
    videoUrl: "none"
},
{
    name:"Olhe Mas N√£o Toque",
    map:"Sajecho Island",
    type:"Trigger Event",
    level:21,
    videoUrl: "none"
},    
];

/* ================= FUN√á√ïES DE TEMPO ================= */
function getGameTime(){
    const now = new Date();
    const base = new Date(now);
    base.setHours(BASE_REAL_TIME.h,BASE_REAL_TIME.m,BASE_REAL_TIME.s,0);

    let diff = (now - base) / 1000;
    if(diff < 0) diff += 86400;

    const total = Math.floor((diff * MULTIPLIER) % 86400);

    return {
        h: Math.floor(total / 3600),
        m: Math.floor((total % 3600) / 60),
        s: total % 60,
        total
    };
}

function formatTime(t){
    return `${String(t.h).padStart(2,"0")}:${String(t.m).padStart(2,"0")}:${String(t.s).padStart(2,"0")}`;
}

function phaseByHour(h){
    if(h < 6) return ["MADRUGADA","dawn"];
    if(h < 12) return ["MANH√É","morning"];
    if(h < 18) return ["TARDE","afternoon"];
    return ["NOITE","night"];
}

function toSeconds(t){
    const [h,m,s] = t.split(":").map(Number);
    return h*3600 + m*60 + s;
}

/* ================= EXTRAIR ID DO YOUTUBE ================= */
// Essa fun√ß√£o pega o link inteiro e retorna s√≥ o ID
function getYoutubeId(url) {
    if (!url) return null;
    // Express√£o regular para achar o ID em v√°rios formatos de link
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}

/* ================= TOOLTIP LOGIC ================= */
const tooltip = document.getElementById("videoTooltip");

function showTooltip(e, videoId) {
    if (!videoId) {
        tooltip.innerHTML = '<div class="no-video">Sem v√≠deo dispon√≠vel</div>';
    } else {
        const thumbUrl = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
        tooltip.innerHTML = `<img src="${thumbUrl}" alt="Preview">`;
    }
    tooltip.style.display = "block";
    moveTooltip(e);
}

function moveTooltip(e) {
    let x = e.clientX + 15;
    let y = e.clientY + 15;
    if (x + 240 > window.innerWidth) x = e.clientX - 255;
    tooltip.style.left = x + "px";
    tooltip.style.top = y + "px";
}

function hideTooltip() {
    tooltip.style.display = "none";
}

/* ================= MODAL LOGIC ================= */
const modal = document.getElementById("videoModal");
const player = document.getElementById("youtubePlayer");

function openModal(videoId) {
    if(!videoId) return;
    const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
    player.src = embedUrl;
    modal.style.display = "flex";
    hideTooltip();
}

function closeModal() {
    modal.style.display = "none";
    player.src = "";
}

document.addEventListener('keydown', function(event) {
    if(event.key === "Escape"){
        closeModal();
    }
});

/* ================= RENDER ================= */
function render(){
    const gt = getGameTime();
    document.getElementById("gameClock").textContent = formatTime(gt);

    const [phase, css] = phaseByHour(gt.h);
    document.body.className = css;
    document.getElementById("phase").textContent = phase;

    const lvl = Number(document.getElementById("filterLevel").value || 0);
    const map = document.getElementById("filterMap").value.toLowerCase();
    const timeInput = document.getElementById("filterTime").value;
    const timeSec = timeInput ? toSeconds(timeInput + ":00") : null;

    const list = document.getElementById("eventList");
    list.innerHTML = "";

    events
    .map(e => {
        // AQUI: Extra√≠mos o ID do link antes de usar
        const videoId = getYoutubeId(e.videoUrl);

        if (!e.startTime) {
            return { ...e, start: null, diff: Infinity, videoId };
        }
        const start = toSeconds(e.startTime);
        let diff = start - gt.total;
        if(diff < 0) diff += 86400;
        return { ...e, start, diff, videoId };
    })
    .filter(e => {
        if (e.level < lvl) return false;
        if (map && !e.map.toLowerCase().includes(map)) return false;
        if (timeSec !== null && e.start !== null) {
            const eventHM = Math.floor(e.start / 60);
            const filterHM = Math.floor(timeSec / 60);
            if (eventHM !== filterHM) return false;
        }
        return true;
    })
    .sort((a,b) => a.diff - b.diff)
    .forEach(e => {
        const div = document.createElement("div");
        div.className = "event";

        if(e.diff <= 60) div.classList.add("active");
        else if(e.diff <= 600) div.classList.add("upcoming");

        // Passamos o videoId extra√≠do para as fun√ß√µes
        div.onmouseenter = (evt) => showTooltip(evt, e.videoId);
        div.onmousemove = (evt) => moveTooltip(evt);
        div.onmouseleave = () => hideTooltip();

        const videoIndicator = e.videoId ? '<span class="video-icon">‚ñ∂ Assistir</span>' : '';
        const titleClass = e.videoId ? 'event-title has-video' : 'event-title';

        div.innerHTML = `
            <div class="${titleClass}">
                ${e.name}
                ${videoIndicator}
            </div>
            <div class="event-info">
                Mapa: ${e.map} ‚Ä¢ Tipo: ${e.type} ‚Ä¢ Level: ${e.level}<br>
                Pr√≥ximo in√≠cio: ${e.start !== null
                    ? formatTime({
                        h: Math.floor(e.start / 3600),
                        m: Math.floor((e.start % 3600) / 60),
                        s: e.start % 60
                      })
                    : "Sem hor√°rio fixo"}
            </div>
        `;

        list.appendChild(div);

        if (e.videoId) {
            const titleElement = div.querySelector('.event-title');
            titleElement.onclick = (evt) => {
                evt.stopPropagation();
                openModal(e.videoId);
            };
        }
    });
}

setInterval(render, 1000);
render();
</script>

</body>
</html>
